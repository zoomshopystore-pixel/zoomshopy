<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ZoomShopy â€” Sign Up</title>
<style>
  body{font-family:Inter,Roboto,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background:#f3f7fb;}
  .card{background:white;padding:30px;border-radius:12px;width:350px;text-align:center;box-shadow:0 4px 10px rgba(0,0,0,0.1);}
  input,button{width:100%;padding:10px;margin:10px 0;border-radius:6px;border:1px solid #ccc;font-size:14px;}
  button{background:#00b4ff;color:white;border:none;cursor:pointer;}
  .google-btn{display:flex;align-items:center;justify-content:center;gap:10px;background:white;border:1px solid #ccc;color:#444;}
  .status{margin-top:10px;font-weight:600;color:#444;}
  .otp-section{display:none;}
</style>
</head>
<body>

<div class="card">
  <h2>Sign Up</h2>

  <div class="form-section">
    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
    <button id="signup-btn">Sign Up</button>
    <div class="divider">or</div>
    <button id="google-signup-btn" class="google-btn">
      <img src="https://www.svgrepo.com/show/475656/google-color.svg" alt="Google" width="20" /> Continue with Google
    </button>
    <p>Already have an account? <a href="signin.html">Sign In</a></p>
  </div>

  <div class="otp-section" id="otp-section">
    <input id="otp" type="text" placeholder="Enter OTP" />
    <button id="verify-otp-btn">Verify OTP</button>
  </div>

  <div class="status" id="status"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDiidI7VfMw5fN0SfKDeQwrLK4HAFfhg78",
  authDomain: "zoom-shopy.firebaseapp.com",
  projectId: "zoom-shopy",
  storageBucket: "zoom-shopy.appspot.com",
  messagingSenderId: "521524635595",
  appId: "1:521524635595:web:c93b6caf4d77ec8525b84e"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const status = document.getElementById("status");

let generatedOTP = null;
let pendingUserEmail = null;
let pendingUserPassword = null;

// Signup with email/password
document.getElementById("signup-btn").addEventListener("click", async () => {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if(!email || !password){ status.textContent="Enter email & password"; status.style.color="red"; return; }

  // Generate OTP
  generatedOTP = Math.floor(100000 + Math.random()*900000);
  pendingUserEmail = email;
  pendingUserPassword = password;

  try {
    await emailjs.send(
      "service_d381wf6",
      "template_jw4wcej",
      { email: email, passcode: generatedOTP, time: new Date(Date.now()+15*60000).toLocaleTimeString() },
      "kYmWGGTZcdWGSv-Uq"
    );
    status.textContent = `OTP sent to ${email}`; status.style.color="green";
    document.querySelector(".form-section").style.display="none";
    document.getElementById("otp-section").style.display="block";
  } catch(err) {
    console.error(err);
    status.textContent="Failed to send OTP. Check your email."; status.style.color="red";
  }
});

// Verify OTP
document.getElementById("verify-otp-btn").addEventListener("click", async () => {
  const enteredOTP = document.getElementById("otp").value.trim();
  if(String(enteredOTP) !== String(generatedOTP)){ status.textContent="Invalid OTP"; status.style.color="red"; return; }

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, pendingUserEmail, pendingUserPassword);
    localStorage.setItem("zoomshopy_current_user", JSON.stringify({ uid:userCredential.user.uid, email:userCredential.user.email }));
    status.textContent="Signup successful! Redirecting..."; status.style.color="green";
    setTimeout(()=>window.location.href="zoomshopy.html",800);
  } catch(err) {
    console.error(err);
    status.textContent="Signup failed"; status.style.color="red";
  }
});

// Google Sign-Up
document.getElementById("google-signup-btn").addEventListener("click", async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    localStorage.setItem("zoomshopy_current_user", JSON.stringify({ uid:user.uid,email:user.email,name:user.displayName||'' }));
    status.textContent=`Welcome ${user.displayName||user.email}! Redirecting...`; status.style.color="green";
    setTimeout(()=>window.location.href="zoomshopy.html",800);
  } catch(err) {
    console.error(err);
    status.textContent="Google Sign Up failed"; status.style.color="red";
  }
});
</script>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  emailjs.init("kYmWGGTZcdWGSv-Uq");
</script>
</body>
</html>
